---
title-block-banner: true
title-block-style: default
title: "University of West Florida"
subtitle: "Time Series Analysis STA 6856 | Professor Dr.Tharindu De Alwis "
date: 09/26/2025
date-format: full
author: "Edwin Quijano"
description: "Assignment 2"
format: pdf
editor: visual
toc: false
execute:
  echo: TRUE
  warning: FALSE
  message: FALSE
---

```{r echo=FALSE}
# Load Libraries

library(ggplot2)
library(dplyr)
library(readr)
library(lubridate)
library(scales)
library(broom)
library(zoo)
library(lmtest)
library(tseries)
library(itsmr) #for trend function
```

### 1. (20 points) Consider the MA(1) model $Y_t = µ − θe_{t−1} + e_t$ where $e_t ∼ W N(0, σ^2)$

**(a) Find** $E(Yt)$

$Y_t = µ − θe_{t−1} + e_t$ where $e_t ∼ W N(0, σ^2)$

$E(Yt)=0 \text{ for all t}$

$Var(Y_t)=\theta^2 \text { for all t}$

$Cov(Y_t,Y_t)$

$$Y_t=μ−θe_{t−1}+et$$

$$E(Y_t)=E(μ)−θE(e_{t−1})+E(e_t)$$ $E(\mu)=\mu$ Constant

$E(e_{t-1})=0$ W N

$E(e_t)=0$ W N

$$E(Y_t)=\mu-\theta (0)+0=\mu$$

\pagebreak

**(b) Find** $V (Y_t) = Cov(Y_t, Y_t)$

$Y_t = µ − θe_{t−1} + e_t$ where $e_t$ is white noise

$$V(Y_t)-\mu=-\theta e_{t-1}+e_t$$

$$Var(Y_t)= Var(-\theta e_{t-1}+e_1 )$$ $$V(Y_t)=Var(-\theta e_{e-1}+e_t) $$ $$=\theta ^2 Var(e_{t-1})+Var(e_t)+2(-\theta (1) \ Cov(e_{t-1}+e_t) $$ $$= \theta^2 \sigma^2+\sigma^2+0=(1+\theta^2)\sigma^2 $$ \pagebreak

**(c) Find** $Cov(Yt, Yt−1)$

$$Y_t−\mu=−\theta e_{t−1}+e_t$$ $$Y_{t−1}−\mu=−\theta e_t−2+e_{t−1}$$

$$Cov(Y_t,Y_{t−1})=Cov(− \theta e_{t−1}+e_t ,− \theta e_{t−2}+e_{t−1})$$ $$=Cov(−\theta e_{t−1},−\theta e_{t−2})+Cov(-\theta e_{t-1},e_{t-1})+Cov(e_t,−\theta e_{t−2})+Cov(e_t,e_{t−1})$$

$=Cov(−\theta e_{t−1},−\theta e_{t−2})=0$

$+Cov(-\theta e_{t-1},e_{t-1})= nonzero$

$+Cov(e_t,−\theta e_{t−2})=0$

$+Cov(e_t,e_{t−1})=0$

$$(t-1, t-2)=0$$ $$(t, t-2)=0$$ $$(t, t-1)=0$$ $$Cov(-\theta e_{t-1},e_{t-1})=\theta Var(e_{t-1})=\theta \sigma^2$$ $$Cov(Y_t,Y_{t-1})=\theta \sigma^2$$

**(d) It can be shown that** $Cov(Y_t, Y_{t−k}) = 0 \text { for } k > 1$. Is ${Y_t}$ stationary? Explain briefly.

$k>1$ has no shared noise terms in $Y_t-\mu=-theta e_{t-1}+e_t \text{ and } Y_{t-k}=-\theta e_{t-k-1}+e_{t-k1}$

$$Cov(Y_t, Y_{t−k}) = 0, k>1 $$ Is Weakly stationary since Covariance depends only on the lag K.

\pagebreak

### 2. (10 points) Consider the MA(3) model with θ1 = 0.8, θ2 = 0.6, and θ3 = 0.4.

**(a) Find the theoretical ACF.**

```{r}
library(stats)

ARMAacf(ma=0.8, lag.max=10)
ARMAacf(ma=0.6, lag.max=10)
ARMAacf(ma=0.4, lag.max=10)
```

\pagebreak

**(b) Generate n = 150 observations of this MA(3) time series. Then, plot the sample autocorrelation function (sample ACF).**

```{r}
set.seed(1) #set.seed will generate the same random sample again and again
x=rnorm(150)
plot(x,main="iid Noise",type="l")

```

### 3. (50 points) The data file winnebago contains monthly unit sales of recreational vehicles from Winnebago, Inc., from November 1966 through February 1972.

Use the following pair of codes to import the dataset

```{r}

library(TSA)

data("winnebago")

y<-winnebago
t<-time(y)
```

**(a) Display and interpret the time series plot for these data.**

```{r}
plot(y, ylab="Monthly unit sales", xlab="Year",
     main="Winnebago unit sales")
abline(v=floor(time(y)), col="red", lty=3)
```

Sales rise sharply from late-1966 to early-1972 — a clear upward trend.

Each year, sales peak in late spring/summer and dip in winter, showing strong 12-month seasonality.

The seasonal ups and downs get larger as sales grow, so variability increases with the level that’s heteroskedasticity and suggests a multiplicative seasonal pattern.

\pagebreak

**(b) Use appropriate method to fit the trend in this data. Interpret the regression output. Plot the standardized residuals from the fit as a time series. Interpret the plot.**

```{r}
reg.trend1 = trend(y, 1) #linear function
reg.trend2 = trend(y, 2) #Quadratic function
reg.trend3 = trend(y,3) # Cubic function

plot(y,type="l",ylim=c(-30,1500),lty=3)
par(new=TRUE)
plot(reg.trend1,col="red",ylim=c(-30,1500),type="l",lwd=1,ylab="",xlab="")
par(new=TRUE)
plot(reg.trend2,col="blue",ylim=c(-30,1500),type="l",lwd=1,ylab="",xlab="")
par(new=TRUE)
plot(reg.trend3,col="green",ylim=c(-30,1500),type="l",lwd=1,ylab="",xlab="")
legend("bottomright",legend=c("True","degree 1","degree 2","degree 3"),col=c("black ","red","blue","green"))
```


```{r}
degree1_resid=y-reg.trend1
degree2_resid=y-reg.trend2
degree3_resid=y-reg.trend3
plot(degree1_resid)
abline(h=0, col="gray")
```


```{r}
plot(degree2_resid)
abline(h=0, col="gray")
```
```{r}
plot(degree3_resid)
abline(h=0, col="gray")
```



```{r}
fit_quad <- lm(as.numeric(y) ~ t + I(t^2))
summary(fit_quad)
```


The standardized residuals still show a clear seasonal pattern positive in summer, negative in winter, and month-to-month correlation. They’re not behaving like random noise.

Residual spread is larger later in time, so the variance isn’t constant.

\pagebreak

**(c) Now take natural logarithms of the monthly sales figures and display and interpret the time series plot of the transformed values.**


```{r}

y_log = log(y)
plot.ts(y_log,
main="Logged Winnebago monthly sales")
abline(v=floor(time(y)), col="lightgray", lty=3)
```

Trend remains upward, but seasonal amplitude becomes roughly constant across time.

The log makes the process look closer to additive (trend + seasonality + noise) with more stable variance.

\pagebreak

**(d) Use appropriate method to fit the trend in this logged data. Display and interpret the time series plot of the standardized residuals from this fit.**

```{r}

fit_log_lin  <- lm(as.numeric(y_log) ~ t)
fit_log_quad <- lm(as.numeric(y_log) ~ t + I(t^2))

AIC(fit_log_lin, fit_log_quad)    
summary(fit_log_lin)

r_std_log <- rstandard(fit_log_lin)
plot(ts(r_std_log, start=start(y), frequency=frequency(y)),
     ylab="Standardized residuals", xlab="Year",
     main="Std. residuals from linear trend (log scale)")
abline(h=0, col="gray")

```


```{r}
# Estimation
wnbg.data.model = c("log","trend",2,"season",4)
r.wnbg = Resid(y,wnbg.data.model)
test(r.wnbg)
```


The time term is significant, sales are rising at a fairly steady percentage rate.

The residuals have roughly constant spread now (variance stabilized), which is better than on the raw scale.

However, the residual plot still shows seasonal waves and month-to-month correlation (big spikes at lags 1–2 and 12 in the ACF),

\pagebreak


**(e) Perform a runs test and Shapiro-Wilk test on the standardized residuals and interpret the results. \[hint: shapiro.test(x)\]**

Recall: The Shapiro-Wilk’s test or Shapiro test is a normality test in statistics. The null hypothesis of Shapiro’s test is that the population is distributed normally.

```{r}
shap_res <- shapiro.test(r.wnbg)  # H0: normality
shap_res
```


$H_0):$ residuals are normally distributed.


Interpretation: With p ≈ 0.38 (> 0.05), fail to reject normality. The residuals are consistent with a normal distribution; $W$ close to 1 also supports this.

Strong evidence the residuals are not random/independent. This means the model hasn’t captured all the time-based structure (ej. seasonality/AR effects).

Shapiro–Wilk test: No evidence against normality of residuals. Their shape is roughly bell-shaped.



**(f) Calculate and interpret the sample autocorrelations for the standardized residuals.**

```{r}
acf(r.wnbg, main="ACF of standardized residuals")
```
The ACF shows big spikes at lag 1 and lag 2, meaning residuals in back-to-back months still move together short-term persistence.

There’s also a large spike at lag 12, signaling a yearly seasonal cycle left in the residuals.

residuals are not white noise.


**(g) Investigate the normality of the standardized residuals (error terms). Consider histograms and normal probability plots. Interpret the plots.**


```{r}
op <- par(mfrow=c(1,2))
hist(r.wnbg, breaks="FD", main="Histogram of std. residuals",
     xlab="Residual", freq=TRUE)
qqnorm(r.wnbg, main="Normal Q–Q plot of std. residuals")
qqline(r.wnbg, col="gray")
par(op)
```
Roughly bell-shaped with no glaring multi-modality. There’s mild tail heft but nothing major.

Residuals look approximately normal. Any minor tail issues are far less important than the leftover seasonality/autocorrelation seen earlier.


